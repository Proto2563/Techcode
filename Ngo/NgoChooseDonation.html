<!DOCTYPE html>
<html>
<head>
  <title>Your Donations</title>
</head>
<body>

<h2>Your Past Donations</h2>
<table border="1" id="donationTable">
  <thead>
    <tr>
      <th>Item Name</th>
      <th>Category</th>
      <th>Drop Location</th>
      <th>Image</th>
      <th>Choose</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  window.onload = function () {
    const urlParams = new URLSearchParams(window.location.search);
    const NID = urlParams.get('NID');

    if (!NID) {
      alert("Donor ID missing");
      return;
    }

    fetch(`http://localhost:3000/NgoChooseDonation`)
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          const tbody = document.querySelector("#donationTable tbody"); //Finds tbody part of table where results will be inserted
//console.log("Data from backend:", data.donations);
          data.donations.forEach(item => {
            //console.log(item);  // ADD THIS TOO
            const row = document.createElement("tr");

            row.innerHTML = `
              <td>${item.IName}</td>
              <td>${item.ICategory}</td>
              <td>${item.IDropLoc}</td>
              <td><img src="../Photo/${item.IPhoto}" width="100"/></td>
              <td>
                <button onclick="chooseItem(${item.IID}, '${NID}', this)">Choose</button>
              </td>
            `;
            //<img src="../Photo/${item.IPhoto}" width="100"/>

            tbody.appendChild(row); //Adds row to end of tbody
          });
        } else {
          alert("Failed to fetch donations");
        }
      })
      .catch(err => {
        console.error("Fetch error:", err);
      });
  };

  function chooseItem(IID, NID, btn) {
  fetch("http://localhost:3000/NgoConfirmDonation", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({ IID: IID, NID: NID })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      // Remove the row from the table
      const row = btn.closest("tr");
      row.remove();
    } else {
      alert("Approval failed");
    }
  })
  .catch(err => {
    console.error("Approval request failed:", err);
  });
}

</script>

</body>
</html>

